{{ $dest := .Destination }}
{{ $destParsed := urls.Parse $dest }}
{{ $section := .Page.Type }}

    {{/*  
    
    - if abs src (dest) path, or page is a leaf bundle (.Page.BundleType = leaf), do nothing
    - else, join the dir + dest to the root
    - This fixes hugo's image src handling
    
    */}}

{{ if or $destParsed.IsAbs (eq .Page.BundleType "leaf") }}
    <img src="{{ $dest }}" alt="{{ .Text }}" title='{{ replace .PlainText "-" " " | title }}' />
{{ else }}

    {{ $newPath := path.Join "/" .Page.File.Dir $dest }}

    <img src="{{ $newPath }}" alt="isNode: {{ .Page.IsNode }} IsPage: {{ .Page.IsPage }} IsSection: {{ .Page.IsSection }} Type: {{ printf .Page.Type }} Type: {{ printf .Page.Type }} BundleType: {{ .Page.BundleType }} Ancestors: {{ delimit .Page.Ancestors ',' }}  File: {{ .Page.File }}" title='{{ replace .PlainText "-" " " | title }}' />
{{ end }}